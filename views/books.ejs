<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BookHive</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #ffffff;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
    }

    /* Navbar */
    .navbar {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      animation: slideDown 0.5s ease;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .nav-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      letter-spacing: 2px;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
    }

    .nav-link {
      color: #b0b0b0;
      text-decoration: none;
      transition: all 0.3s ease;
      font-weight: 500;
      position: relative;
    }

    .nav-link::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #57d8fa, #e50914);
      transition: width 0.3s ease;
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .nav-link:hover {
      color: #57d8fa;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2.5rem;
      padding: 2.5rem 2rem;
      background: linear-gradient(135deg,
          rgba(229, 9, 20, 0.1) 0%,
          rgba(87, 216, 250, 0.1) 100%);
      border-radius: 24px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.8s ease;
    }

    .header::before {
      content: "";
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle,
          rgba(87, 216, 250, 0.1) 0%,
          transparent 70%);
      animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .title {
      font-size: clamp(2rem, 4vw, 3.5rem);
      font-weight: 800;
      margin-bottom: 0.8rem;
      position: relative;
      z-index: 1;
    }

    .college-name {
      display: inline-block;
      position: relative;
      z-index: 1;
    }

    .tt {
      color: #57d8fa;
      text-shadow: 0 0 10px rgba(87, 216, 250, 0.5);
    }

    .g {
      color: #28a1be;
      text-shadow: 0 0 10px rgba(40, 161, 190, 0.5);
    }

    .p {
      color: #fab440;
      text-shadow: 0 0 10px rgba(250, 180, 64, 0.5);
    }

    .c {
      color: #fe5784;
      text-shadow: 0 0 10px rgba(254, 87, 132, 0.5);
    }

    .e {
      color: #cc0e41;
      text-shadow: 0 0 10px rgba(204, 14, 65, 0.5);
    }

    .t {
      color: #73b66b;
      text-shadow: 0 0 10px rgba(115, 182, 107, 0.5);
    }

    .subtitle {
      color: #b0b0b0;
      font-size: 1.1rem;
      margin-top: 1rem;
      position: relative;
      z-index: 1;
    }

    /* Search & Filter Section */
    .search-filter-section {
      margin-bottom: 2.5rem;
      animation: fadeIn 1s ease 0.2s both;
    }

    .search-form {
      display: flex;
      gap: 1rem;
      max-width: 900px;
      margin: 0 auto 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 60px;
      border: 2px solid rgba(229, 9, 20, 0.3);
      transition: all 0.3s ease;
    }

    .search-form:focus-within {
      border-color: rgba(229, 9, 20, 0.8);
      box-shadow: 0 0 40px rgba(229, 9, 20, 0.3);
    }

    .search-input {
      flex: 1;
      background: transparent;
      border: none;
      padding: 0.9rem 1.5rem;
      color: #fff;
      font-size: 1rem;
      outline: none;
    }

    .search-input::placeholder {
      color: #666;
    }

    .search-clear {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #888;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .search-clear:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    /* Filter Chips */
    .filter-chips {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 900px;
      margin: 0 auto;
    }

    .filter-chip {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #b0b0b0;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .filter-chip:hover,
    .filter-chip.active {
      background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
      border-color: transparent;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
    }

    /* Results Info */
    .results-info {
      text-align: center;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1rem;
      animation: fadeIn 1s ease 0.4s both;
    }

    .results-count {
      color: #888;
      font-size: 1rem;
    }

    .results-count span {
      color: #57d8fa;
      font-weight: 700;
      font-size: 1.1rem;
    }

    .view-toggle {
      display: flex;
      gap: 0.5rem;
    }

    .view-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #888;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .view-btn.active {
      background: rgba(229, 9, 20, 0.2);
      border-color: #e50914;
      color: #e50914;
    }

    /* Books Grid */
    .books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 2.5rem;
      padding: 1rem;
      animation: fadeIn 1s ease 0.6s both;
    }

    .books-grid.list-view {
      grid-template-columns: 1fr;
    }

    /* Enhanced Book Card */
    .book-card {
      background: linear-gradient(145deg,
          rgba(255, 255, 255, 0.05) 0%,
          rgba(255, 255, 255, 0.02) 100%);
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .book-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #57d8fa, #e50914, #73b66b, #fab440);
      background-size: 300% 100%;
      opacity: 0;
      transition: opacity 0.3s ease;
      animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {

      0%,
      100% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }
    }

    .book-card:hover::before {
      opacity: 1;
    }

    .book-card:hover {
      transform: translateY(-15px) scale(1.02);
      box-shadow: 0 25px 50px rgba(229, 9, 20, 0.3),
        0 0 0 1px rgba(229, 9, 20, 0.5);
      border-color: rgba(229, 9, 20, 0.5);
    }

    .book-image-container {
      position: relative;
      height: 420px;
      overflow: hidden;
      background: linear-gradient(135deg, #1a1a2e 0%, #0f1419 100%);
    }

    .book-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.5s ease;
      filter: brightness(0.9);
    }

    .book-card:hover .book-image {
      transform: scale(1.15) rotate(2deg);
      filter: brightness(1.1);
    }

    .book-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      font-size: 0.85rem;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(229, 9, 20, 0.5);
      z-index: 10;
    }

    .book-favorite {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      border: none;
      color: #fff;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      z-index: 10;
    }

    .book-favorite:hover {
      background: rgba(229, 9, 20, 0.8);
      transform: scale(1.1);
    }

    .book-favorite.active {
      background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
    }

    .book-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top,
          rgba(0, 0, 0, 0.95) 0%,
          rgba(0, 0, 0, 0.7) 50%,
          transparent 100%);
      padding: 3rem 1.5rem 1.5rem;
      transform: translateY(100%);
      transition: transform 0.4s ease;
    }

    .book-card:hover .book-overlay {
      transform: translateY(0);
    }

    .overlay-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .overlay-tag {
      background: rgba(87, 216, 250, 0.2);
      backdrop-filter: blur(10px);
      color: #57d8fa;
      padding: 0.3rem 0.7rem;
      border-radius: 15px;
      font-size: 0.8rem;
      border: 1px solid rgba(87, 216, 250, 0.4);
    }

    .book-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.8rem;
      gap: 1rem;
    }

    .book-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      background: linear-gradient(135deg, #ffffff 0%, #57d8fa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .book-description {
      color: #b0b0b0;
      font-size: 0.95rem;
      line-height: 1.7;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex: 1;
    }

    .book-meta {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
      margin-top: auto;
    }

    .meta-tag {
      display: flex;
      align-items: center;
      gap: 0.5rem;;
      background: rgba(87, 216, 250, 0.1);
      color: #57d8fa;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      font-size: 0.85rem;
      border: 1px solid rgba(87, 216, 250, 0.3);
      transition: all 0.3s ease;
    }

    .meta-tag:hover {
      background: rgba(87, 216, 250, 0.2);
      transform: translateY(-2px);
    }

    .book-actions {
      display: flex;
      gap: 0.8rem;
      margin-top: 1rem;
    }

    .action-btn {
      flex: 1;
      background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
      border: none;
      color: white;
      padding: 1rem;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(229, 9, 20, 0.3);
      position: relative;
      overflow: hidden;
    }

    .action-btn::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .action-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .action-btn:hover {
      box-shadow: 0 8px 30px rgba(229, 9, 20, 0.6);
      transform: translateY(-3px);
    }

    .action-btn span {
      position: relative;
      z-index: 1;
    }

    /* List View Styles */
    .books-grid.list-view .book-card {
      flex-direction: row;
      height: 280px;
    }

    .books-grid.list-view .book-image-container {
      width: 200px;
      height: 100%;
    }

    .books-grid.list-view .book-content {
      flex: 1;
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.8rem;
      margin-top: 3rem;
      flex-wrap: wrap;
      animation: fadeIn 1s ease 0.8s both;
    }

    .page-btn {
      background: rgba(255, 255, 255, 0.05);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.7rem 1.2rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .page-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .page-btn.active {
      background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
      border-color: transparent;
      box-shadow: 0 5px 20px rgba(229, 9, 20, 0.4);
    }

    .page-btn:hover:not(:disabled):not(.active) {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    /* Empty State */
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 6rem 2rem;
      color: #666;
    }

    .empty-icon {
      font-size: 5rem;
      margin-bottom: 1.5rem;
      opacity: 0.5;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-20px);
      }
    }

    .empty-state h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #999;
    }

    /* Loading Spinner */
    .loading {
      display: none;
      text-align: center;
      padding: 3rem;
      grid-column: 1 / -1;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top: 4px solid #e50914;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .navbar {
        padding: 1rem;
      }

      .nav-content {
        flex-direction: column;
        gap: 1rem;
      }

      .nav-links {
        gap: 1rem;
      }

      .books-grid {
        grid-template-columns: 1fr;
      }

      .search-form {
        flex-direction: column;
        border-radius: 20px;
      }

      .results-info {
        flex-direction: column;
        gap: 1rem;
      }

      .books-grid.list-view .book-card {
        flex-direction: column;
        height: auto;
      }

      .books-grid.list-view .book-image-container {
        width: 100%;
        height: 400px;
      }
    }

    /* Horizontal scroll categories (Desktop) */
    .scroll-categories {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      white-space: nowrap;
      padding: 10px 5px;
      margin-bottom: 20px;
      scrollbar-width: none;
    }

    .scroll-categories::-webkit-scrollbar {
      display: none;
    }

    .cat-chip {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.15);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      color: #b0b0b0;
      cursor: pointer;
      transition: 0.25s ease;
    }

    .cat-chip:hover {
      background: rgba(229, 9, 20, 0.3);
      color: #fff;
    }

    .cat-chip.active {
      background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
      color: #fff;
      border: none;
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-content">
      <div class="logo">
        <span class="tt">B</span><span class="g">o</span><span class="p">o</span><span class="c">k</span><span
          class="e">H</span><span class="t">ive</span>
      </div>

      <div class="nav-links">
        <a href="/" class="nav-link">Home</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1 class="title">Book Recommender System</h1>
      <div class="college-name">
        <span class="tt">B</span><span class="g">o</span><span class="p">o</span><span class="c">k</span><span
          class="e">H</span><span class="t">ive</span> Library
      </div>

      <p class="subtitle">Discover your next great read</p>
    </div>

    <!-- Search & Filter -->
    <div class="search-filter-section">
      <form class="search-form" id="searchForm" action="/books" method="GET">
        <input class="search-input" type="text" name="title"
          placeholder=" Search for books by title, author, country, or genre..." value="<%= queryTitle %>"
          id="searchInput" autocomplete="off" />
        <button type="button" class="search-clear" id="clearBtn" style="display: <%= queryTitle ? 'block' : 'none' %>">
          ✕
        </button>
      </form>

      <!-- <div class="filter-chips">
          <button class="filter-chip active" data-filter="all">
            All Books
          </button>
          <button class="filter-chip" data-filter="recent">
            Recently Added
          </button>
          <button class="filter-chip" data-filter="popular">
            Most Popular
          </button>
        </div> -->
      <div class="scroll-categories">
        <a class="cat-chip <%= category === 'all' ? 'active' : '' %>" href="/books?category=all">
          All Books
        </a>

        <% categories.forEach(cat=> { %>
          <a class="cat-chip <%= category === cat ? 'active' : '' %>"
            href="/books?category=<%= cat %>&title=<%= queryTitle %>">
            <%= cat %>
          </a>
          <% }) %>
      </div>
    </div>

    <!-- Results Info -->
    <div class="results-info">
      <div class="results-count">
        Showing <span id="displayCount">0</span> of
        <span id="totalCount">
          <%= allData.length %>
        </span> books
      </div>
      <div class="view-toggle">
        <button class="view-btn active" id="gridView" title="Grid View">
          ⊞
        </button>
        <button class="view-btn" id="listView" title="List View">☰</button>
      </div>
    </div>

    <!-- Books Grid -->
    <div class="books-grid" id="booksGrid">
      <div class="loading" id="loading">
        <div class="spinner"></div>
      </div>

      <% if (allData.length===0) { %>
        <div class="empty-state">
          <div class="empty-icon"></div>
          <h2>No books found</h2>
          <p>Try a different search term or browse all books</p>
        </div>
        <% } else { %>
          <% allData.forEach(data=> { %>
            <div class="book-card" data-book-id="<%= data._id %>">
              <div class="book-image-container">
                <button class="book-favorite" onclick="toggleFavorite(event, '<%= data._id %>')">
                  ♡
                </button>
                <% if (data.price) { %>
                  <div class="book-badge">
                    <%= data.price %>
                  </div>
                  <% } %>
                    <img class="book-image" src="<%= data.image %>" alt="<%= data.title[0] %>"
                      onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'" />
                    <div class="book-overlay">
                      <div class="overlay-tags">
                        <span class="overlay-tag">
                          <%= data.author %>
                        </span>
                        <span class="overlay-tag">
                          <%= data.country %>
                        </span>
                      </div>
                    </div>
              </div>
              <div class="book-content">
                <div>
                  <h2 class="book-title">
                    <%= data.title[0] %>
                      <%= data.title[1] || '' %>
                  </h2>
                  <p class="book-description">
                    <%= data.description %>
                  </p>
                </div>
                <div class="book-meta">
                  <span class="meta-tag"><svg fill="currentColor" height="12px" width="12px" version="1.1" id="Layer_1"
                      xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                      viewBox="0 0 511.999 511.999" xml:space="preserve">
                      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                      <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                      <g id="SVGRepo_iconCarrier">
                        <g>
                          <g>
                            <path
                              d="M489.194,474.529h-377.58l55.961-23.531c2.258-0.903,4.648-2.525,6.251-4.133l332.686-332.686 c7.315-7.314,7.315-19.174,0-26.49L424.316,5.493c-7.314-7.314-19.175-7.314-26.49,0C391.77,11.549,74.956,328.364,65.14,338.179 c-1.696,1.693-3.284,4.12-4.132,6.247L1.527,485.883c-5.281,12.299,3.787,26.109,17.218,26.109h470.449 c10.345,0,18.731-8.387,18.731-18.731S499.538,474.529,489.194,474.529z M411.071,45.226l55.707,55.707l-40.787,40.787 l-55.707-55.707L411.071,45.226z M343.795,112.503l55.707,55.707L160.582,407.13l-55.707-55.707L343.795,112.503z M84.848,384.376 l42.78,42.781l-73.82,31.04L84.848,384.376z">
                            </path>
                          </g>
                        </g>
                      </g>
                    </svg>
                    <%= data.author %>
                  </span>
                  <span class="meta-tag">
                    <svg version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64"
                      xml:space="preserve" fill="currentColor" stroke="currentColor" stroke-width="1.5" height="14px"
                      width="15px">
                      <g id="SVGRepo_bgCarrier" stroke-width="1.5"></g>
                      <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                      <g id="SVGRepo_iconCarrier">
                        <g>
                          <path fill="currentColor"
                            d="M32,0C14.327,0,0,14.327,0,32s14.327,32,32,32s32-14.327,32-32S49.673,0,32,0z M27.819,6.415l0.176-0.205 c0.446-0.515,0.951-1.098,1.027-2.1c0.066-0.833-0.228-1.421-0.546-1.897C29.633,2.077,30.807,2,32,2 c1.465,0,2.903,0.11,4.312,0.313c0.262,0.327,0.606,0.668,1.164,0.897c0.592,0.255,1.291,0.457,2.171,0.249 c0.26-0.062,0.462-0.172,0.636-0.292c0.618,0.177,1.229,0.369,1.831,0.584c0.211,0.609,0.616,1.335,1.604,1.46 c0.556,0.079,1.021-0.008,1.428-0.183c8.475,4.139,14.702,12.153,16.39,21.734c-0.164,0.346-0.188,0.686-0.193,0.901 c-0.002,0.06,0.003,0.121,0.008,0.137c-0.036,0.056-0.082,0.085-0.305,0.192c-0.255,0.123-0.603,0.291-0.924,0.629 c-0.365,0.377-0.533,0.75-0.668,1.05c-0.105,0.234-0.165,0.361-0.274,0.47c-0.07,0.068-0.206,0.109-0.42,0.171 c-0.418,0.12-1.049,0.301-1.473,0.988c-0.403,0.649-0.369,1.249-0.345,1.687c0.003,0.05,0.007,0.101,0.009,0.153 c-0.077,0.038-0.171,0.077-0.269,0.109c0.058-0.316,0.066-0.753-0.217-1.202c-0.382-0.583-0.887-0.671-1.153-0.671 c-0.508,0-0.891,0.292-1.137,0.531c0.005-0.484-0.006-0.93-0.085-1.264c-0.074-0.336-0.027-0.523,0.131-1.065l0.055-0.19 c0.071-0.258,0.212-0.442,0.406-0.698c0.267-0.35,0.599-0.785,0.757-1.457c0.177-0.732,0.125-1.272,0.074-1.795 c-0.019-0.185-0.038-0.38-0.047-0.605l-0.019-0.529c-0.02-0.622-0.036-1.159-0.189-1.943l-0.069-0.349 c-0.154-0.787-0.288-1.466-0.85-2.323c-0.481-0.719-0.861-1.224-1.704-1.672c-0.199-0.109-0.406-0.197-0.617-0.263 c-0.341-0.114-0.653-0.153-0.955-0.192l-0.312-0.042c-0.533-0.078-1.013,0.015-1.366,0.087c-0.286,0.058-0.468,0.105-0.611,0.026 c-0.143-0.078-0.211-0.16-0.388-0.384c-0.094-0.119-0.193-0.244-0.324-0.389c-0.132-0.142-0.222-0.274-0.309-0.399 c-0.172-0.245-0.385-0.551-0.76-0.854c-0.4-0.325-0.705-0.553-1.279-0.754c-1.021-0.338-1.96-0.086-2.77,0.201 c-0.664,0.23-1.069,0.564-1.428,0.858c-0.157,0.13-0.323,0.268-0.484,0.376c-0.158,0.092-0.3,0.156-0.434,0.22 c-0.316,0.147-0.675,0.315-1.072,0.668c-0.276,0.242-1.213,0.853-1.43,0.908c-0.097-0.004-0.193-0.043-0.368-0.118 c-0.226-0.098-0.534-0.229-0.89-0.258l-0.217-0.013c-0.067,0-0.136,0.004-0.187,0.009c-0.454,0.034-0.773,0.182-1.008,0.289 c-0.092,0.042-0.186,0.09-0.304,0.119c-0.346,0.086-0.736,0.08-1.128,0.059c-0.627-0.032-1.242-0.014-1.806,0.146 c-0.463,0.131-0.798,0.357-1.042,0.523c-0.263,0.178-0.326,0.209-0.426,0.21c-0.101,0-0.173-0.042-0.452-0.262 c-0.276-0.218-0.655-0.517-1.214-0.672c-0.403-0.108-0.69-0.143-0.994-0.18l-0.277-0.034c-0.525-0.076-0.9-0.107-1.325-0.142 c-0.197-0.016-0.405-0.032-0.648-0.056l-0.282-0.005l-0.046,0.018c-0.033,0.002-0.072,0.004-0.115,0.006l-0.011-0.007 c-0.32-0.223-0.651-0.452-1.137-0.688c-0.358-0.176-0.649-0.31-0.969-0.425c-0.014-0.357-0.054-0.833-0.161-1.153 c-0.023-0.073-0.047-0.137-0.078-0.217c0.011-0.046,0.031-0.123,0.07-0.24c0.13-0.376,0.332-0.658,0.42-0.771 c0.054-0.037,0.104-0.069,0.152-0.101c0.187-0.12,0.418-0.27,0.656-0.528c0.667-0.706,0.97-1.387,1.046-2.357 c0.06-0.866-0.423-1.448-0.743-1.834C24.52,9.293,24.378,9.122,24.358,9.1c0.043-0.169,0.118-0.242,0.536-0.519 c0.228-0.151,0.466-0.312,0.693-0.511c0.258-0.223,0.506-0.364,0.792-0.527C26.827,7.288,27.334,6.999,27.819,6.415z M4.406,43.785 c-1.138-2.661-1.9-5.521-2.225-8.511c0.245-0.46,0.542-0.906,0.946-1.398c0.289-0.345,0.596-0.554,0.95-0.795 c0.431-0.294,0.92-0.628,1.383-1.207c0.556-0.677,0.738-1.399,0.885-1.98c0.158-0.623,0.248-0.933,0.578-1.162 c0.46-0.314,0.824-0.348,1.484-0.41c0.237-0.021,0.488-0.046,0.765-0.085l0.368-0.054c1.298-0.191,2.127-0.277,3.206,0.027 c0.732,0.205,1.183,0.547,1.754,0.979c0.376,0.285,0.802,0.607,1.346,0.918c0.422,0.241,0.779,0.507,1.124,0.764 c0.771,0.573,1.568,1.165,2.893,1.359c0.76,0.105,1.4-0.13,1.885-0.313c0.243-0.093,0.473-0.18,0.616-0.18 c0.033,0,0.075,0.003,0.143,0.04c0.655,0.364,0.801,0.666,0.828,0.873c-0.14,0.039-0.343,0.074-0.492,0.101 c-0.703,0.123-2.011,0.352-2.162,1.699c-0.076,0.65,0.147,1.057,0.35,1.283c0.524,0.591,1.501,0.528,2.602,0.28 c0.474-0.107,0.965-0.219,1.358-0.219c0.179,0,0.285,0.024,0.333,0.041c0.29,0.105,0.603,0.182,0.908,0.254 c0.134,0.031,0.313,0.073,0.467,0.115c-0.113,0.021-0.229,0.042-0.327,0.059c-0.461,0.079-0.982,0.169-1.459,0.396 c-0.376,0.175-0.697,0.341-0.998,0.498c-0.614,0.318-1.1,0.57-1.84,0.771c-0.226,0.06-0.569,0.009-0.93-0.052 c-0.286-0.049-0.581-0.099-0.893-0.099c-0.738,0-1.319,0.293-1.723,0.865c-0.924,1.292-0.376,2.643-0.112,3.294 c0.359,0.883,1.205,1.936,3.187,1.936c0.933,0,2.012-0.227,3.395-0.713c0.954-0.338,1.513-0.949,1.961-1.441 c0.362-0.398,0.648-0.712,1.11-0.918l0.509-0.232c1.048-0.483,1.815-0.827,2.639-0.439c0.221,0.104,0.317,0.302,0.518,0.798 c0.233,0.578,0.553,1.37,1.444,1.844c0.811,0.43,1.824,0.274,2.564,0.062c0.444-0.127,0.8-0.236,1.058-0.085 c0.271,0.161,0.383,0.379,0.589,0.817c0.184,0.391,0.412,0.877,0.853,1.339c0.132,0.139,0.256,0.274,0.375,0.404 c0.731,0.801,1.423,1.557,2.792,1.881c0.197,0.046,0.398,0.069,0.598,0.069c0.7,0,1.263-0.279,1.715-0.504 c0.388-0.192,0.687-0.336,0.931-0.26c1.021,0.334,1.233,0.563,1.329,0.971c0.084,0.327-0.262,0.602-1.544,1.221 c-0.204,0.099-0.407,0.197-0.6,0.297c-0.689,0.355-1.205,0.399-1.986,0.466c-0.312,0.026-0.645,0.055-1.004,0.104 c-0.725,0.091-1.38,0.248-2.014,0.4c-0.731,0.176-1.422,0.341-2.023,0.341s-1.081-0.165-1.545-0.529 c-0.38-0.304-0.556-0.627-0.8-1.073c-0.177-0.324-0.377-0.691-0.693-1.109c-0.279-0.352-0.519-0.858-0.751-1.349 c-0.512-1.083-1.149-2.431-2.598-2.431c-0.247,0-0.504,0.044-0.764,0.132c-1.126,0.379-1.501,1.281-1.775,1.939 c-0.118,0.283-0.229,0.55-0.379,0.77c-0.375,0.535-0.564,1.103-0.732,1.604c-0.281,0.841-0.369,0.94-0.593,0.973 c-0.361,0.052-0.588-0.101-1.125-0.489c-0.16-0.116-0.326-0.237-0.502-0.353c-0.346-0.23-0.55-0.485-0.809-0.809 c-0.289-0.361-0.617-0.771-1.154-1.157c-0.597-0.44-1.136-0.651-1.611-0.838c-0.384-0.15-0.716-0.28-1.082-0.523 c-0.139-0.093-0.262-0.249-0.405-0.431c-0.325-0.412-0.816-1.035-1.786-1.07l-0.101-0.002c-0.731,0-1.752,0.26-2.466,1.497 c-0.259,0.448-0.44,1.053-0.634,1.693c-0.314,1.045-0.745,2.474-1.42,2.474h-0.001c-0.698-0.047-2.753-1.846-3.741-2.711 c-0.708-0.62-1.32-1.155-1.761-1.447l-0.332-0.229C6.498,44.301,5.72,43.76,4.692,43.76C4.598,43.76,4.502,43.775,4.406,43.785z M32,62c-11.484,0-21.458-6.456-26.499-15.936c0.192,0.117,0.393,0.252,0.608,0.401l0.362,0.249 c0.336,0.223,0.928,0.74,1.555,1.289c2.08,1.82,3.65,3.115,4.929,3.202c2.26,0.149,2.986-2.301,3.466-3.893 c0.151-0.503,0.309-1.023,0.451-1.271c0.265-0.458,0.518-0.496,0.772-0.497c0.056,0.03,0.189,0.2,0.277,0.312 c0.206,0.262,0.464,0.588,0.867,0.857c0.547,0.363,1.032,0.553,1.462,0.721c0.412,0.161,0.768,0.301,1.162,0.593 c0.325,0.232,0.531,0.491,0.771,0.79c0.309,0.385,0.657,0.82,1.265,1.226c0.154,0.102,0.296,0.205,0.434,0.304 c0.648,0.472,1.395,1.017,2.58,0.852c1.505-0.216,1.928-1.481,2.208-2.318c0.137-0.408,0.266-0.793,0.481-1.102 c0.272-0.398,0.436-0.791,0.579-1.137c0.257-0.616,0.342-0.737,0.568-0.813c0.07-0.024,0.108-0.031,0.134-0.027 c0.203,0.064,0.579,0.859,0.781,1.286c0.267,0.565,0.57,1.205,0.978,1.719c0.213,0.281,0.361,0.554,0.52,0.842 c0.286,0.525,0.611,1.121,1.312,1.683c0.827,0.647,1.738,0.962,2.788,0.962c0.838,0,1.641-0.192,2.489-0.396 c0.581-0.14,1.183-0.284,1.808-0.362c0.332-0.045,0.632-0.07,0.913-0.095c0.87-0.073,1.691-0.144,2.735-0.682 c0.178-0.092,0.364-0.182,0.552-0.272c1.245-0.602,3.127-1.511,2.616-3.499c-0.388-1.654-1.859-2.136-2.657-2.396 c-0.252-0.08-0.511-0.121-0.77-0.121c-0.673,0-1.223,0.273-1.665,0.493c-0.384,0.191-0.705,0.338-0.966,0.279 c-0.766-0.182-1.145-0.597-1.772-1.283c-0.127-0.14-0.26-0.283-0.402-0.434c-0.218-0.229-0.345-0.499-0.492-0.812 c-0.252-0.536-0.565-1.203-1.377-1.686c-0.816-0.485-1.87-0.337-2.635-0.116c-0.441,0.127-0.797,0.239-1.069,0.093 c-0.228-0.12-0.331-0.332-0.529-0.825c-0.24-0.595-0.568-1.41-1.52-1.859c-0.528-0.248-1.053-0.369-1.603-0.369 c-0.99,0-1.834,0.39-2.728,0.803l-0.483,0.221c-0.845,0.376-1.36,0.942-1.775,1.397c-0.388,0.426-0.668,0.733-1.147,0.902 c-1.146,0.403-2.039,0.6-2.729,0.6c-0.928,0-1.195-0.35-1.334-0.689c-0.338-0.833-0.306-1.108-0.018-1.405 c0.175,0,0.362,0.037,0.557,0.07c0.522,0.088,1.2,0.164,1.782,0.013c0.954-0.258,1.581-0.584,2.245-0.929 c0.278-0.145,0.573-0.298,0.927-0.463c0.235-0.111,0.598-0.174,0.947-0.234c0.777-0.134,2.396-0.411,2.278-2.084 c-0.121-1.496-1.484-1.816-2.299-2.008c-0.229-0.054-0.464-0.106-0.689-0.188c-0.284-0.101-0.594-0.153-0.944-0.159 c0.146-0.216,0.247-0.484,0.275-0.82c0.085-1.224-0.538-2.215-1.855-2.946c-0.35-0.193-0.724-0.291-1.111-0.291 c-0.512,0-0.945,0.165-1.327,0.311c-0.344,0.13-0.644,0.238-0.889,0.203c-0.82-0.12-1.309-0.483-1.984-0.985 c-0.374-0.278-0.799-0.594-1.325-0.896c-0.433-0.246-0.771-0.503-1.13-0.774c-0.651-0.493-1.324-1.004-2.42-1.312 c-1.395-0.392-2.583-0.296-4.041-0.08l-0.359,0.053c-0.238,0.034-0.458,0.054-0.666,0.073c-0.757,0.071-1.539,0.144-2.433,0.754 c-0.967,0.672-1.197,1.585-1.383,2.319c-0.118,0.467-0.221,0.87-0.501,1.213c-0.283,0.354-0.58,0.556-0.955,0.812 c-0.295,0.201-0.617,0.425-0.947,0.734C2.004,32.108,2,32.055,2,32C2,17.388,12.45,5.221,26.283,2.551 c0.111,0.172,0.225,0.339,0.334,0.49c0.348,0.48,0.434,0.633,0.411,0.915c-0.025,0.331-0.151,0.49-0.545,0.944L26.287,5.13 c-0.26,0.312-0.527,0.465-0.898,0.676c-0.328,0.188-0.701,0.4-1.111,0.754c-0.163,0.142-0.33,0.25-0.488,0.354 c-0.477,0.316-1.131,0.75-1.371,1.701c-0.244,0.983,0.319,1.662,0.656,2.068c0.108,0.132,0.291,0.352,0.287,0.411 c-0.04,0.51-0.147,0.753-0.514,1.14c-0.071,0.078-0.133,0.119-0.276,0.212c-0.113,0.072-0.232,0.15-0.364,0.251l-0.121,0.11 c-0.06,0.063-0.586,0.643-0.898,1.551c-0.237,0.715-0.247,1.088-0.044,1.598l0.044,0.118c0.036,0.121,0.07,0.547,0.072,0.822 l-0.084,1.218l0.814,0.203c0.535,0.133,0.806,0.244,1.353,0.514c0.351,0.169,0.582,0.33,0.874,0.533l0.294,0.199 c0.392,0.234,0.79,0.193,1.213,0.146c0.211,0.021,0.397,0.035,0.574,0.05c0.385,0.03,0.725,0.058,1.209,0.128l0.314,0.039 c0.244,0.03,0.438,0.051,0.708,0.123c0.154,0.043,0.285,0.143,0.502,0.313c0.37,0.292,0.877,0.691,1.705,0.691 c0.724-0.005,1.192-0.323,1.534-0.556c0.198-0.134,0.317-0.212,0.465-0.253c0.348-0.099,0.746-0.095,1.151-0.074 c0.584,0.033,1.175,0.021,1.723-0.115c0.255-0.064,0.458-0.152,0.652-0.242c0.17-0.078,0.233-0.105,0.254-0.109l0.072,0.002 L36.64,19.7c0.066,0.005,0.169,0.049,0.299,0.104c0.257,0.11,0.608,0.262,1.138,0.28c1.079,0,2.751-1.39,2.771-1.407 c0.186-0.164,0.341-0.236,0.599-0.357c0.182-0.085,0.373-0.176,0.636-0.329c0.276-0.183,0.496-0.361,0.704-0.532 c0.294-0.241,0.487-0.401,0.82-0.517c0.697-0.248,1.029-0.34,1.461-0.194c0.247,0.086,0.347,0.155,0.666,0.414 c0.156,0.126,0.239,0.246,0.379,0.445c0.136,0.195,0.28,0.397,0.475,0.605c0.087,0.097,0.159,0.188,0.227,0.275 c0.218,0.275,0.489,0.619,0.997,0.899c0.633,0.344,1.408,0.294,1.978,0.179c0.256-0.052,0.455-0.1,0.668-0.067l0.354,0.048 c0.244,0.031,0.42,0.054,0.591,0.11c0.086,0.026,0.176,0.062,0.284,0.12c0.438,0.233,0.602,0.441,0.987,1.017 c0.342,0.522,0.417,0.906,0.554,1.604l0.071,0.357c0.121,0.615,0.134,1.033,0.151,1.611l0.02,0.551 c0.011,0.265,0.032,0.497,0.054,0.716c0.043,0.438,0.071,0.728-0.028,1.138c-0.059,0.25-0.178,0.415-0.402,0.709 c-0.254,0.333-0.57,0.748-0.74,1.369l-0.05,0.17c-0.181,0.62-0.353,1.206-0.16,2.073c0.045,0.193,0.036,0.76,0.029,1.174 c-0.019,1.132-0.03,1.88,0.444,2.362c0.217,0.221,0.505,0.342,0.811,0.342l0.31-0.021l0.204-0.098 c0.285-0.136,0.532-0.331,0.754-0.547c0.008,0.018,0.015,0.035,0.022,0.053c0.275,0.614,0.863,0.967,1.615,0.967 c0.824,0,2.492-0.584,2.606-1.665c0.027-0.285,0.016-0.543,0.002-0.786c-0.021-0.351-0.014-0.419,0.053-0.526 c0.039-0.03,0.207-0.079,0.318-0.11c0.35-0.101,0.827-0.237,1.269-0.664c0.387-0.384,0.56-0.77,0.699-1.079 c0.104-0.232,0.164-0.359,0.286-0.485c0.072-0.076,0.17-0.126,0.348-0.211C61.964,30.525,62,31.258,62,32 C62,48.568,48.568,62,32,62z">
                          </path>
                          <path fill="currentColor"
                            d="M44.629,28.162c-1.1,0.317-1.496,1.157-1.786,1.771c-0.155,0.33-0.29,0.614-0.512,0.819 c-0.392,0.366-0.771,0.568-1.211,0.802c-0.488,0.26-1.041,0.554-1.613,1.088c-0.204,0.189-0.438,0.352-0.661,0.511 c-0.737,0.523-1.852,1.314-1.525,2.804c0.214,0.935,0.933,1.493,1.922,1.493c0.655,0,1.366-0.229,2.055-0.451 c0.34-0.109,0.677-0.22,0.984-0.288c1.752-0.383,2.951-0.842,4.263-2.16c0.144-0.143,0.294-0.286,0.446-0.432 c1.134-1.08,2.846-2.713,1.573-4.603C47.708,28.231,46.191,27.713,44.629,28.162z M45.61,32.671 c-0.162,0.155-0.323,0.309-0.48,0.465c-0.983,0.988-1.806,1.299-3.277,1.621c-0.365,0.08-0.767,0.208-1.17,0.338 c-0.502,0.161-1.069,0.345-1.414,0.354c0.021-0.122,0.18-0.271,0.735-0.665c0.271-0.193,0.58-0.412,0.865-0.678 c0.382-0.355,0.756-0.555,1.19-0.786c0.493-0.263,1.053-0.56,1.632-1.102c0.504-0.464,0.757-1,0.96-1.431 c0.256-0.541,0.335-0.646,0.532-0.703C45.376,30.028,45.564,30,45.742,30c0.491,0,0.881,0.21,1.16,0.629 C47.16,31.012,46.87,31.47,45.61,32.671z">
                          </path>
                          <path fill="currentColor"
                            d="M32.422,53.081c-0.231,0-0.465,0.036-0.707,0.11c-1.458,0.47-1.389,1.934-1.353,2.721 c0.014,0.289,0.026,0.562-0.001,0.8c-0.023,0.217-0.083,0.425-0.136,0.625c-0.178,0.672-0.446,1.686,0.437,2.556 c0.416,0.4,0.941,0.612,1.52,0.612c0.859,0,1.826-0.497,2.593-1.334c1.174-1.307,1.188-3.217,0.043-4.633 C34.284,53.859,33.531,53.081,32.422,53.081z M33.292,57.827c-0.406,0.445-0.866,0.678-1.11,0.678c-0.06,0-0.09-0.012-0.138-0.053 c-0.021-0.092,0.062-0.399,0.115-0.603c0.071-0.271,0.153-0.579,0.189-0.914c0.046-0.391,0.027-0.776,0.012-1.117 c-0.011-0.233-0.026-0.571,0.003-0.731c0.168-0.03,0.365,0.029,0.89,0.697C33.792,56.451,33.806,57.256,33.292,57.827z">
                          </path>
                        </g>
                      </g>
                    </svg>
                    <%= data.country %>
                  </span>
                </div>
                <div class="book-actions">
                  <form action="/books/<%= data._id %>" style="flex: 1">
                    <button class="action-btn" type="submit">
                      <span>View Details →</span>
                    </button>
                  </form>
                </div>
              </div>
            </div>
            <% }) %>
              <% } %>
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination"></div>
  </div>

  <script>
    // Debounce function
    function debounce(func, delay) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), delay);
      };
    }

    // Search functionality
    const searchForm = document.getElementById("searchForm");
    const searchInput = document.getElementById("searchInput");
    const clearBtn = document.getElementById("clearBtn");

    searchInput.addEventListener(
      "input",
      debounce(() => {
        clearBtn.style.display = searchInput.value ? "block" : "none";
        searchForm.submit();
      }, 600)
    );

    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      clearBtn.style.display = "none";
      window.location.href = "/books";
    });

    // View toggle
    const gridViewBtn = document.getElementById("gridView");
    const listViewBtn = document.getElementById("listView");
    const booksGrid = document.getElementById("booksGrid");

    gridViewBtn.addEventListener("click", () => {
      booksGrid.classList.remove("list-view");
      gridViewBtn.classList.add("active");
      listViewBtn.classList.remove("active");
    });

    listViewBtn.addEventListener("click", () => {
      booksGrid.classList.add("list-view");
      listViewBtn.classList.add("active");
      gridViewBtn.classList.remove("active");
    });

    // Filter chips
    const filterChips = document.querySelectorAll(".filter-chip");
    filterChips.forEach((chip) => {
      chip.addEventListener("click", () => {
        filterChips.forEach((c) => c.classList.remove("active"));
        chip.classList.add("active");
        // Add filter logic here
      });
    });

    // Favorite functionality
    function toggleFavorite(event, bookId) {
      event.stopPropagation();
      const btn = event.currentTarget;
      btn.classList.toggle("active");
      btn.textContent = btn.classList.contains("active") ? "♥" : "♡";

      // Save to localStorage
      let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      if (btn.classList.contains("active")) {
        favorites.push(bookId);
      } else {
        favorites = favorites.filter((id) => id !== bookId);
      }
      localStorage.setItem("favorites", JSON.stringify(favorites));
    }

    // Load favorites on page load
    window.addEventListener("load", () => {
      const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      favorites.forEach((id) => {
        const card = document.querySelector(`[data-book-id="${id}"]`);
        if (card) {
          const btn = card.querySelector(".book-favorite");
          btn.classList.add("active");
          btn.textContent = "♥";
        }
      });
    });

    // Pagination
    const booksPerPage = 6;
    let books = document.querySelectorAll(".book-card");
    const pagination = document.getElementById("pagination");
    const displayCount = document.getElementById("displayCount");
    let currentPage = 1;

    function showPage(page, shouldScroll = true) {
      const totalPages = Math.ceil(books.length / booksPerPage);
      if (page < 1) page = 1;
      if (page > totalPages) page = totalPages;
      currentPage = page;

      let visibleCount = 0;
      books.forEach((book, idx) => {
        const shouldShow =
          idx >= (page - 1) * booksPerPage && idx < page * booksPerPage;
        book.style.display = shouldShow ? "flex" : "none";
        if (shouldShow) visibleCount++;
      });

      displayCount.textContent = visibleCount;
      renderPagination(totalPages);

      // Only scroll when shouldScroll = true
      if (shouldScroll) {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    }

    function renderPagination(totalPages) {
      pagination.innerHTML = "";
      if (totalPages <= 1) return;

      // Previous button
      const prevBtn = document.createElement("button");
      prevBtn.textContent = "← Prev";
      prevBtn.className = "page-btn";
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => showPage(currentPage - 1);
      pagination.appendChild(prevBtn);

      // Page numbers with ellipsis
      const maxVisible = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
      let endPage = Math.min(totalPages, startPage + maxVisible - 1);

      if (endPage - startPage < maxVisible - 1) {
        startPage = Math.max(1, endPage - maxVisible + 1);
      }

      // First page
      if (startPage > 1) {
        const btn = document.createElement("button");
        btn.textContent = "1";
        btn.className = "page-btn";
        btn.onclick = () => showPage(1);
        pagination.appendChild(btn);

        if (startPage > 2) {
          const ellipsis = document.createElement("span");
          ellipsis.textContent = "...";
          ellipsis.style.padding = "0.7rem";
          ellipsis.style.color = "#666";
          pagination.appendChild(ellipsis);
        }
      }

      // Page numbers
      for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = "page-btn" + (i === currentPage ? " active" : "");
        btn.onclick = () => showPage(i);
        pagination.appendChild(btn);
      }

      // Last page
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          const ellipsis = document.createElement("span");
          ellipsis.textContent = "...";
          ellipsis.style.padding = "0.7rem";
          ellipsis.style.color = "#666";
          pagination.appendChild(ellipsis);
        }

        const btn = document.createElement("button");
        btn.textContent = totalPages;
        btn.className = "page-btn";
        btn.onclick = () => showPage(totalPages);
        pagination.appendChild(btn);
      }

      // Next button
      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Next →";
      nextBtn.className = "page-btn";
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => showPage(currentPage + 1);
      pagination.appendChild(nextBtn);
    }

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
      const totalPages = Math.ceil(books.length / booksPerPage);
      if (e.key === "ArrowLeft" && currentPage > 1) {
        showPage(currentPage - 1);
      } else if (e.key === "ArrowRight" && currentPage < totalPages) {
        showPage(currentPage + 1);
      }
    });

    // Initialize
    if (books.length > 0) {
      showPage(1);
    } else {
      displayCount.textContent = "0";
    }

    // Smooth scroll for card clicks
    document.querySelectorAll(".book-card").forEach((card) => {
      card.addEventListener("click", (e) => {
        if (
          !e.target.closest(".book-favorite") &&
          !e.target.closest(".action-btn")
        ) {
          const form = card.querySelector("form");
          if (form) form.submit();
        }
      });
    });

    // Add loading animation on form submit
    searchForm.addEventListener("submit", () => {
      document.getElementById("loading").style.display = "block";
    });

    // Intersection Observer for card animations
    const observerOptions = {
      threshold: 0.1,
      rootMargin: "0px 0px -50px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.style.opacity = "1";
            entry.target.style.transform = "translateY(0)";
          }, index * 100);
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);

    // Apply animation to visible cards
    books.forEach((card) => {
      card.style.opacity = "0";
      card.style.transform = "translateY(30px)";
      card.style.transition = "opacity 0.6s ease, transform 0.6s ease";
      observer.observe(card);
    });

    // Search suggestions (optional enhancement)
    const searchSuggestions = [
      "Fiction",
      "Non-Fiction",
      "Science",
      "History",
      "Biography",
      "Mystery",
      "Romance",
      "Thriller",
    ];

    searchInput.addEventListener("focus", () => {
      // You can implement autocomplete suggestions here
    });

    // Performance optimization: Lazy load images
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const img = entry.target;
          if (img.dataset.src) {
            img.src = img.dataset.src;
            img.removeAttribute("data-src");
          }
          imageObserver.unobserve(img);
        }
      });
    });

    document.querySelectorAll(".book-image").forEach((img) => {
      imageObserver.observe(img);
    });

    // Add reading time estimator
    document.querySelectorAll(".book-description").forEach((desc) => {
      const wordCount = desc.textContent.split(" ").length;
      const readingTime = Math.ceil(wordCount / 200); // Average reading speed
      if (readingTime > 0) {
        const timeTag = document.createElement("span");
        timeTag.className = "meta-tag";
        timeTag.innerHTML = `⏱ ${readingTime} min read`;
        timeTag.style.background = "rgba(250, 180, 64, 0.1)";
        timeTag.style.color = "#fab440";
        timeTag.style.borderColor = "rgba(250, 180, 64, 0.3)";
        const metaContainer = desc
          .closest(".book-content")
          .querySelector(".book-meta");
        if (metaContainer) {
          metaContainer.appendChild(timeTag);
        }
      }
    });

    // Share functionality
    function shareBook(bookId, title) {
      if (navigator.share) {
        navigator
          .share({
            title: title,
            text: `Check out this book: ${title}`,
            url: window.location.origin + "/books/" + bookId,
          })
          .catch((err) => console.log("Error sharing:", err));
      } else {
        // Fallback: Copy to clipboard
        const url = window.location.origin + "/books/" + bookId;
        navigator.clipboard.writeText(url);
        alert("Link copied to clipboard!");
      }
    }

    // Add tooltip for truncated text
    document
      .querySelectorAll(".book-title, .book-description")
      .forEach((element) => {
        element.addEventListener("mouseenter", function () {
          if (this.scrollHeight > this.clientHeight) {
            this.title = this.textContent;
          }
        });
      });

    // Print statistics in console
    console.log(` Total Books: ${books.length}`);
    console.log(` Pages: ${Math.ceil(books.length / booksPerPage)}`);
    console.log(
      ` Favorites: ${JSON.parse(localStorage.getItem("favorites") || "[]").length
      }`
    );

    // CATEGORY FILTER WITHOUT PAGE RELOAD
    document.querySelectorAll(".cat-chip").forEach((chip) => {
      chip.addEventListener("click", function (e) {
        e.preventDefault();

        // FIX ACTIVE CHIP
        document
          .querySelectorAll(".cat-chip")
          .forEach((c) => c.classList.remove("active"));
        this.classList.add("active");

        const url = this.getAttribute("href");
        document.getElementById("loading").style.display = "block";

        fetch(url, { headers: { "X-Requested-With": "XMLHttpRequest" } })
          .then((res) => res.json())
          .then((data) => {
            // FIX TOTAL COUNT
            document.getElementById("totalCount").textContent =
              data.allData.length;

            const grid = document.getElementById("booksGrid");

            // Remove old cards
            grid
              .querySelectorAll(".book-card, .empty-state")
              .forEach((el) => el.remove());

            if (data.allData.length === 0) {
              grid.innerHTML += `
            <div class="empty-state">
              <div class="empty-icon"></div>
              <h2>No books found</h2>
              <p>Try another category</p>
            </div>`;
              return;
            }

            // Insert new cards
            data.allData.forEach((book) => {
              grid.innerHTML += `
            <div class="book-card" data-book-id="${book._id}">
              <div class="book-image-container">
                <button class="book-favorite" onclick="toggleFavorite(event, '${book._id
                }')">♡</button>
                ${book.price
                  ? `<div class="book-badge">${book.price}</div>`
                  : ""
                }
                <img class="book-image" src="${book.image
                }" onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'">
                <div class="book-overlay">
                  <div class="overlay-tags">
                    <span class="overlay-tag">${book.author}</span>
                    <span class="overlay-tag">${book.country}</span>
                  </div>
                </div>
              </div>
              <div class="book-content">
                <h2 class="book-title">${book.title.join(" ")}</h2>
                <p class="book-description">${book.description}</p>
                <div class="book-meta">
                  <span class="meta-tag">${book.author}</span>
                  <span class="meta-tag">${book.country}</span>
                </div>
                <div class="book-actions">
                  <form action="/books/${book._id}" style="flex: 1">
                    <button class="action-btn" type="submit"><span>View Details →</span></button>
                  </form>
                </div>
              </div>
            </div>`;
            });

            books = document.querySelectorAll(".book-card");
            showPage(1, false); // don't scroll to top
          })
          .finally(() => {
            document.getElementById("loading").style.display = "none";
          });
      });
    });
  </script>
</body>

</html>